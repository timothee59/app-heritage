# Story 6.1 - "Supprimer" une fiche (soft delete)

## Epic
Epic 6 : Gestion des fiches (soft delete)

## User Story
**En tant qu'** utilisateur  
**Je veux** pouvoir "supprimer" une fiche  
**Afin de** retirer un objet qui a Ã©tÃ© vendu, donnÃ© ou qui n'est plus pertinent

## Contexte
La suppression est "soft" : la fiche reste visible mais barrÃ©e. Cela Ã©vite les erreurs irrÃ©versibles et permet de garder une trace. N'importe qui peut supprimer (transparence et confiance familiale).

## CritÃ¨res d'Acceptation

- [ ] Un bouton "Supprimer" est prÃ©sent sur la page de dÃ©tail
- [ ] Une confirmation est demandÃ©e avant suppression
- [ ] La fiche n'est pas vraiment supprimÃ©e, juste marquÃ©e (deleted_at, deleted_by)
- [ ] La fiche reste visible dans la galerie mais apparaÃ®t barrÃ©e/grisÃ©e
- [ ] Le nom de la personne ayant supprimÃ© est enregistrÃ©
- [ ] Les fiches supprimÃ©es sont affichÃ©es en fin de liste (aprÃ¨s les actives)

## Ã‰lÃ©ments Techniques

### API Endpoint
```
DELETE /api/items/:id
Headers: { X-User-Id: 123 }
â†’ Met Ã  jour deleted_at et deleted_by
â†’ Retourne la fiche mise Ã  jour
```

### SQL (soft delete)
```sql
UPDATE items 
SET deleted_at = NOW(), deleted_by = $2
WHERE id = $1
RETURNING *;
```

### Confirmation
```jsx
function DeleteButton({ itemId, onDelete }) {
  const handleDelete = async () => {
    const confirmed = window.confirm(
      'Voulez-vous vraiment supprimer cette fiche ?\n\n' +
      'Elle restera visible (barrÃ©e) et pourra Ãªtre restaurÃ©e.'
    );
    
    if (confirmed) {
      await deleteItem(itemId);
      onDelete();
    }
  };

  return (
    <button className="delete-btn" onClick={handleDelete}>
      ğŸ—‘ï¸ Supprimer
    </button>
  );
}
```

### Affichage dans la galerie
```jsx
function ItemCard({ item }) {
  const isDeleted = item.deleted_at !== null;
  
  return (
    <div className={`item-card ${isDeleted ? 'deleted' : ''}`}>
      <img src={item.photo} />
      <span className="item-number">#{item.number}</span>
      {isDeleted && <div className="deleted-overlay">âœ•</div>}
    </div>
  );
}
```

### Styles
```css
.item-card.deleted {
  opacity: 0.5;
  position: relative;
}

.item-card.deleted::after {
  content: '';
  position: absolute;
  top: 50%;
  left: -5%;
  width: 110%;
  height: 3px;
  background: #dc3545;
  transform: rotate(-10deg);
}

.deleted-overlay {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 3rem;
  color: #dc3545;
  opacity: 0.7;
}
```

### Tri avec supprimÃ©s en fin
```sql
SELECT * FROM items
ORDER BY 
  CASE WHEN deleted_at IS NULL THEN 0 ELSE 1 END,
  number;
```

## Maquette SimplifiÃ©e

```
Page de dÃ©tail :
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â† Retour           #12      â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚    [Photo]                  â”‚
â”‚    Buffet                   â”‚
â”‚                             â”‚
â”‚    [â¤ï¸] [ğŸ¤”] [ğŸ‘‹]           â”‚
â”‚                             â”‚
â”‚    [ğŸ—‘ï¸ Supprimer]           â”‚
â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Confirmation :
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Voulez-vous vraiment       â”‚
â”‚  supprimer cette fiche ?    â”‚
â”‚                             â”‚
â”‚  Elle restera visible       â”‚
â”‚  (barrÃ©e) et pourra Ãªtre    â”‚
â”‚  restaurÃ©e.                 â”‚
â”‚                             â”‚
â”‚  [Annuler]  [Supprimer]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Galerie avec fiche supprimÃ©e :
â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“·    â”‚ â”‚ ğŸ“· â•²  â”‚ â”‚ ğŸ“·    â”‚
â”‚  #1   â”‚ â”‚ #2 â•±  â”‚ â”‚  #3   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜
           supprimÃ©
```

## DÃ©pendances
- 5.1 : La galerie (affichage des fiches supprimÃ©es)
- 5.2 : La page de dÃ©tail (bouton supprimer)

## Stories LiÃ©es
- 6.2 : Affichage visuel des fiches supprimÃ©es
- 6.3 : Restauration d'une fiche supprimÃ©e
