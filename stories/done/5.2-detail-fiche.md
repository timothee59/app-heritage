# Story 5.2 - Voir le dÃ©tail d'une fiche

## Epic
Epic 5 : Consultation et vues filtrÃ©es

## User Story
**En tant qu'** utilisateur  
**Je veux** voir le dÃ©tail d'une fiche  
**Afin de** voir la photo en grand, les informations et les choix de chacun

## Contexte
C'est l'Ã©cran le plus complet : photo(s), titre, description, commentaires, prÃ©fÃ©rences de tous les membres de la famille. C'est aussi lÃ  qu'on fait son choix.

## CritÃ¨res d'Acceptation

- [ ] La page affiche la photo en grand (ou carousel si plusieurs)
- [ ] Le numÃ©ro est affichÃ© en Ã©vidence
- [ ] Le titre est affichÃ© (ou placeholder "Ajouter un titre...")
- [ ] La description est affichÃ©e (ou placeholder)
- [ ] Les trois boutons de prÃ©fÃ©rence sont prÃ©sents
- [ ] La section "Qui veut quoi ?" liste les prÃ©fÃ©rences de tous
- [ ] Les commentaires sont affichÃ©s
- [ ] Un bouton "Retour" permet de revenir Ã  la galerie
- [ ] Navigation possible vers fiche prÃ©cÃ©dente/suivante (swipe ou boutons)

## Ã‰lÃ©ments Techniques

### API Endpoint
```
GET /api/items/:id
Headers: { X-User-Id: 123 }
â†’ Retourne {
    id, number, title, description,
    photos: [{ id, data, position }],
    myPreference,
    allPreferences: [
      { user: { id, name, role }, level: "love" },
      { user: { id, name, role }, level: "maybe" },
    ],
    comments: [
      { id, text, user: { id, name }, created_at }
    ],
    deleted_at, deleted_by
  }
```

### SQL avec toutes les donnÃ©es
```sql
-- Fiche de base
SELECT * FROM items WHERE id = $1;

-- Photos
SELECT * FROM photos WHERE item_id = $1 ORDER BY position;

-- Ma prÃ©fÃ©rence
SELECT level FROM preferences WHERE item_id = $1 AND user_id = $2;

-- Toutes les prÃ©fÃ©rences
SELECT p.level, u.id, u.name, u.role
FROM preferences p
JOIN users u ON p.user_id = u.id
WHERE p.item_id = $1;

-- Commentaires
SELECT c.*, u.name as user_name
FROM comments c
JOIN users u ON c.user_id = u.id
WHERE c.item_id = $1
ORDER BY c.created_at;
```

### Structure de la page
```jsx
function ItemDetail({ item }) {
  return (
    <div className="item-detail">
      <header>
        <button onClick={goBack}>â† Retour</button>
        <span>#{item.number}</span>
      </header>
      
      <PhotoCarousel photos={item.photos} />
      
      <section className="info">
        <EditableTitle value={item.title} />
        <EditableDescription value={item.description} />
      </section>
      
      <section className="my-choice">
        <h3>Mon choix</h3>
        <PreferenceButtons currentLevel={item.myPreference} />
      </section>
      
      <section className="all-choices">
        <h3>Qui veut quoi ?</h3>
        <PreferencesList preferences={item.allPreferences} />
      </section>
      
      <section className="comments">
        <h3>Commentaires</h3>
        <CommentsList comments={item.comments} />
        <AddCommentForm />
      </section>
    </div>
  );
}
```

## Maquette SimplifiÃ©e

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â† Retour           #12      â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                             â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚    â”‚                   â”‚    â”‚
â”‚    â”‚      ğŸ“· 1/3       â”‚    â”‚
â”‚    â”‚                   â”‚    â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚         â— â—‹ â—‹               â”‚
â”‚                             â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  Buffet salle Ã  manger      â”‚
â”‚  [modifier]                 â”‚
â”‚                             â”‚
â”‚  Meuble en chÃªne massif,    â”‚
â”‚  bon Ã©tat gÃ©nÃ©ral.          â”‚
â”‚  [modifier]                 â”‚
â”‚                             â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  Mon choix :                â”‚
â”‚  [â¤ï¸ Je le veux!] [ğŸ¤”] [ğŸ‘‹] â”‚
â”‚                             â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  Qui veut quoi ?            â”‚
â”‚                             â”‚
â”‚  â¤ï¸ Marie, Pierre           â”‚
â”‚  ğŸ¤” Jean                    â”‚
â”‚  ğŸ‘‹ Sophie                  â”‚
â”‚  â“ Paul (pas encore vu)    â”‚
â”‚                             â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  ğŸ’¬ Commentaires (2)        â”‚
â”‚                             â”‚
â”‚  Marie Â· Hier               â”‚
â”‚  "C'est le buffet de        â”‚
â”‚   mamie Jeanne !"           â”‚
â”‚                             â”‚
â”‚  [Ajouter un commentaire]   â”‚
â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## DÃ©pendances
- 5.1 : La galerie (point d'entrÃ©e)
- Epic 3 : Titre, description, commentaires
- Epic 4 : PrÃ©fÃ©rences

## Stories LiÃ©es
- 5.3 : Section "Qui veut quoi"
