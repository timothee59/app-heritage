# Story 4.4 - Modifier sa prÃ©fÃ©rence

## Epic
Epic 4 : Expression des prÃ©fÃ©rences

## User Story
**En tant qu'** utilisateur  
**Je veux** modifier ma prÃ©fÃ©rence sur un objet  
**Afin de** changer d'avis si nÃ©cessaire

## Contexte
Les prÃ©fÃ©rences ne sont pas figÃ©es. AprÃ¨s rÃ©flexion ou discussion familiale, quelqu'un peut dÃ©cider de laisser un objet Ã  un autre. Il faut pouvoir changer facilement son choix.

## CritÃ¨res d'Acceptation

- [ ] Cliquer sur un autre bouton de prÃ©fÃ©rence change immÃ©diatement le choix
- [ ] L'ancien choix est dÃ©sÃ©lectionnÃ©, le nouveau est sÃ©lectionnÃ©
- [ ] La modification est sauvegardÃ©e immÃ©diatement en base
- [ ] Un feedback visuel confirme le changement
- [ ] Cliquer sur le bouton dÃ©jÃ  actif ne fait rien (ou affiche une confirmation)

## Ã‰lÃ©ments Techniques

### MÃªme endpoint (upsert)
L'endpoint `POST /api/items/:itemId/preferences` gÃ¨re dÃ©jÃ  la mise Ã  jour grÃ¢ce au `ON CONFLICT`.

### UX de changement
```jsx
function PreferenceButtons({ itemId, currentLevel, onUpdate }) {
  const [loading, setLoading] = useState(false);

  const handleClick = async (level) => {
    if (level === currentLevel) return; // DÃ©jÃ  sÃ©lectionnÃ©
    
    setLoading(true);
    try {
      await updatePreference(itemId, level);
      onUpdate(level);
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className={`preference-buttons ${loading ? 'loading' : ''}`}>
      {/* ... boutons */}
    </div>
  );
}
```

### Animation de transition
```css
.pref-btn {
  transition: all 0.2s ease;
}

.pref-btn.active {
  transform: scale(1.05);
}

.preference-buttons.loading {
  opacity: 0.7;
  pointer-events: none;
}
```

## Maquette SimplifiÃ©e

```
Avant (coup de cÅ“ur) :
â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”
â”‚  â¤ï¸   â”‚ â”‚  ğŸ¤”   â”‚ â”‚  ğŸ‘‹   â”‚
â”‚[ACTIF]â”‚ â”‚       â”‚ â”‚       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜

â†’ Clic sur "Si personne"

AprÃ¨s :
â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”
â”‚  â¤ï¸   â”‚ â”‚  ğŸ¤”   â”‚ â”‚  ğŸ‘‹   â”‚
â”‚       â”‚ â”‚[ACTIF]â”‚ â”‚       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜

âœ“ PrÃ©fÃ©rence mise Ã  jour
```

## DÃ©pendances
- 4.1, 4.2, 4.3 : Les trois niveaux de prÃ©fÃ©rence

## Stories LiÃ©es
- 4.5 : Voir sa prÃ©fÃ©rence actuelle
- 5.3 : Les autres voient le changement
