# Story 4.1 - Marquer "Je le veux !" (coup de cÅ“ur)

## Epic
Epic 4 : Expression des prÃ©fÃ©rences

## User Story
**En tant qu'** utilisateur  
**Je veux** marquer une fiche comme "Je le veux !" (coup de cÅ“ur)  
**Afin d'** indiquer clairement que cet objet m'intÃ©resse fortement

## Contexte
C'est le niveau d'intÃ©rÃªt le plus fort. Un coup de cÅ“ur signifie "je veux vraiment cet objet". Si plusieurs personnes ont un coup de cÅ“ur sur le mÃªme objet, il y a "conflit" Ã  rÃ©soudre en famille.

## CritÃ¨res d'Acceptation

- [ ] Sur la page de dÃ©tail, trois boutons permettent de choisir son niveau d'intÃ©rÃªt
- [ ] Le bouton "Je le veux !" est visuellement distinct (â¤ï¸ ou couleur rouge/rose)
- [ ] Cliquer sur ce bouton enregistre la prÃ©fÃ©rence "love"
- [ ] Le bouton reste actif/sÃ©lectionnÃ© aprÃ¨s le clic
- [ ] La prÃ©fÃ©rence est sauvegardÃ©e immÃ©diatement
- [ ] Un feedback visuel confirme l'enregistrement (ex: animation du bouton)

## Ã‰lÃ©ments Techniques

### Table preferences
```sql
CREATE TABLE preferences (
  id SERIAL PRIMARY KEY,
  item_id INT REFERENCES items(id) ON DELETE CASCADE,
  user_id INT REFERENCES users(id),
  level VARCHAR(10) CHECK (level IN ('love', 'maybe', 'no')),
  updated_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(item_id, user_id)
);
```

### API Endpoint
```
POST /api/items/:itemId/preferences
Body: { level: "love" }
Headers: { X-User-Id: 123 }
â†’ CrÃ©e ou met Ã  jour la prÃ©fÃ©rence
â†’ Retourne { item_id, user_id, level }
```

### Upsert SQL
```sql
INSERT INTO preferences (item_id, user_id, level, updated_at)
VALUES ($1, $2, $3, NOW())
ON CONFLICT (item_id, user_id)
DO UPDATE SET level = $3, updated_at = NOW()
RETURNING *;
```

### Composant de prÃ©fÃ©rences
```jsx
function PreferenceButtons({ itemId, currentLevel, onUpdate }) {
  const levels = [
    { key: 'love', label: 'Je le veux !', icon: 'â¤ï¸', color: 'red' },
    { key: 'maybe', label: 'Si personne', icon: 'ğŸ¤”', color: 'orange' },
    { key: 'no', label: 'Pas intÃ©ressÃ©', icon: 'ğŸ‘‹', color: 'gray' },
  ];

  return (
    <div className="preference-buttons">
      {levels.map(({ key, label, icon, color }) => (
        <button
          key={key}
          className={`pref-btn ${currentLevel === key ? 'active' : ''}`}
          style={{ '--btn-color': color }}
          onClick={() => onUpdate(key)}
        >
          <span className="icon">{icon}</span>
          <span className="label">{label}</span>
        </button>
      ))}
    </div>
  );
}
```

## Maquette SimplifiÃ©e

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    [Photo]                  â”‚
â”‚    #12 - Buffet             â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                             â”‚
â”‚    Votre choix :            â”‚
â”‚                             â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”
â”‚    â”‚  â¤ï¸   â”‚ â”‚  ğŸ¤”   â”‚ â”‚  ğŸ‘‹   â”‚
â”‚    â”‚ Je le â”‚ â”‚  Si   â”‚ â”‚ Pas   â”‚
â”‚    â”‚ veux! â”‚ â”‚person-â”‚ â”‚intÃ©-  â”‚
â”‚    â”‚       â”‚ â”‚  ne   â”‚ â”‚ressÃ©  â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚     [ACTIF]
â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

Ã‰tat actif :
```css
.pref-btn.active {
  border: 3px solid var(--btn-color);
  background: var(--btn-color-light);
  transform: scale(1.05);
}
```

## DÃ©pendances
- 5.2 : La page de dÃ©tail d'une fiche
- Epic 1 : Identification de l'utilisateur

## Stories LiÃ©es
- 4.2 : Marquer "Si personne d'autre"
- 4.3 : Marquer "Pas intÃ©ressÃ©"
- 4.4 : Modifier sa prÃ©fÃ©rence
- 4.5 : Voir sa prÃ©fÃ©rence actuelle
