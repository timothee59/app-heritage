# Story 6.3 - Restaurer une fiche supprimÃ©e

## Epic
Epic 6 : Gestion des fiches (soft delete)

## User Story
**En tant qu'** utilisateur  
**Je veux** restaurer une fiche supprimÃ©e  
**Afin de** corriger une erreur ou remettre un objet en jeu

## Contexte
Si une fiche a Ã©tÃ© supprimÃ©e par erreur ou si la situation change (vente annulÃ©e, objet retrouvÃ©...), on peut la remettre dans le catalogue actif.

## CritÃ¨res d'Acceptation

- [ ] Un bouton "Restaurer" est visible sur les fiches supprimÃ©es
- [ ] Cliquer restaure immÃ©diatement la fiche (pas de confirmation nÃ©cessaire)
- [ ] La fiche redevient active (deleted_at = NULL)
- [ ] La fiche retrouve sa place normale dans la galerie (triÃ©e par numÃ©ro)
- [ ] Un feedback confirme la restauration

## Ã‰lÃ©ments Techniques

### API Endpoint
```
PATCH /api/items/:id/restore
Headers: { X-User-Id: 123 }
â†’ Remet deleted_at et deleted_by Ã  NULL
â†’ Retourne la fiche mise Ã  jour
```

### SQL
```sql
UPDATE items 
SET deleted_at = NULL, deleted_by = NULL
WHERE id = $1
RETURNING *;
```

### Bouton de restauration
```jsx
function RestoreButton({ itemId, onRestore }) {
  const [loading, setLoading] = useState(false);

  const handleRestore = async () => {
    setLoading(true);
    try {
      await restoreItem(itemId);
      onRestore();
      showToast('Fiche restaurÃ©e !');
    } finally {
      setLoading(false);
    }
  };

  return (
    <button 
      className="restore-btn" 
      onClick={handleRestore}
      disabled={loading}
    >
      {loading ? '...' : 'â™»ï¸ Restaurer'}
    </button>
  );
}
```

### Dans la banniÃ¨re de suppression
```jsx
{item.deleted_at && (
  <div className="deleted-banner">
    <span>
      ğŸ—‘ï¸ SupprimÃ©e par {item.deleted_by_name}
    </span>
    <RestoreButton itemId={item.id} onRestore={refresh} />
  </div>
)}
```

## Maquette SimplifiÃ©e

```
Fiche supprimÃ©e avec bouton restaurer :
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ—‘ï¸ SupprimÃ©e par Marie  â”‚ â”‚
â”‚ â”‚                         â”‚ â”‚
â”‚ â”‚         [â™»ï¸ Restaurer]  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                             â”‚
â”‚    [Photo barrÃ©e]           â”‚
â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

AprÃ¨s restauration :
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                             â”‚
â”‚  âœ… Fiche restaurÃ©e !       â”‚
â”‚                             â”‚
â”‚    [Photo normale]          â”‚
â”‚                             â”‚
â”‚    #2 - Lampe ancienne      â”‚
â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## DÃ©pendances
- 6.1 : Le soft delete
- 6.2 : L'affichage des fiches supprimÃ©es

## Stories LiÃ©es
- Aucune
