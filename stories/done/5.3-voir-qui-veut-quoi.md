# Story 5.3 - Voir sur chaque fiche qui veut quoi

## Epic
Epic 5 : Consultation et vues filtrÃ©es

## User Story
**En tant qu'** utilisateur  
**Je veux** voir sur chaque fiche qui veut quoi  
**Afin de** savoir si cet objet m'intÃ©resse vraiment vu les autres intÃ©ressÃ©s

## Contexte
La transparence est clÃ©. Tout le monde voit les choix de tout le monde. Cela permet d'identifier les conflits et de faciliter les discussions.

## CritÃ¨res d'Acceptation

- [ ] Une section "Qui veut quoi ?" liste les prÃ©fÃ©rences de tous
- [ ] Les prÃ©noms sont groupÃ©s par niveau : â¤ï¸, ğŸ¤”, ğŸ‘‹
- [ ] Les personnes n'ayant pas encore vu la fiche sont listÃ©es sÃ©parÃ©ment (â“)
- [ ] Le rÃ´le (parent/enfant) est indiquÃ© si utile
- [ ] L'affichage est clair mÃªme avec beaucoup de personnes
- [ ] Les conflits (plusieurs â¤ï¸) sont mis en Ã©vidence visuellement

## Ã‰lÃ©ments Techniques

### Structure des donnÃ©es
```javascript
const groupedPreferences = {
  love: [{ name: 'Marie', role: 'enfant' }, { name: 'Pierre', role: 'enfant' }],
  maybe: [{ name: 'Jean', role: 'enfant' }],
  no: [{ name: 'Sophie', role: 'enfant' }],
  notSeen: [{ name: 'Paul', role: 'enfant' }]
};
```

### Calcul cÃ´tÃ© serveur
```sql
-- Utilisateurs sans prÃ©fÃ©rence sur cet item
SELECT u.id, u.name, u.role
FROM users u
WHERE u.id NOT IN (
  SELECT user_id FROM preferences WHERE item_id = $1
);
```

### Composant d'affichage
```jsx
function PreferencesList({ preferences, allUsers }) {
  const grouped = groupByLevel(preferences);
  const notSeen = allUsers.filter(u => 
    !preferences.some(p => p.user.id === u.id)
  );

  const sections = [
    { level: 'love', icon: 'â¤ï¸', label: 'Veulent cet objet', items: grouped.love },
    { level: 'maybe', icon: 'ğŸ¤”', label: 'Si personne d\'autre', items: grouped.maybe },
    { level: 'no', icon: 'ğŸ‘‹', label: 'Pas intÃ©ressÃ©s', items: grouped.no },
    { level: 'notSeen', icon: 'â“', label: 'Pas encore vu', items: notSeen },
  ];

  return (
    <div className="preferences-list">
      {sections.map(({ level, icon, label, items }) => (
        items.length > 0 && (
          <div key={level} className={`pref-group ${level}`}>
            <span className="icon">{icon}</span>
            <span className="names">
              {items.map(u => u.name).join(', ')}
            </span>
          </div>
        )
      ))}
      
      {grouped.love?.length > 1 && (
        <div className="conflict-warning">
          âš ï¸ {grouped.love.length} personnes veulent cet objet !
        </div>
      )}
    </div>
  );
}
```

### Styles
```css
.pref-group {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 0;
}

.pref-group .icon {
  font-size: 1.2rem;
}

.pref-group.love .names {
  font-weight: bold;
}

.pref-group.notSeen .names {
  opacity: 0.6;
  font-style: italic;
}

.conflict-warning {
  background: #fff3cd;
  border: 1px solid #ffc107;
  padding: 8px 12px;
  border-radius: 4px;
  margin-top: 12px;
  font-weight: bold;
}
```

## Maquette SimplifiÃ©e

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Qui veut quoi ?            â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                             â”‚
â”‚  â¤ï¸ Marie, Pierre           â”‚
â”‚  ğŸ¤” Jean                    â”‚
â”‚  ğŸ‘‹ Sophie                  â”‚
â”‚  â“ Paul, Maman             â”‚
â”‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ âš ï¸ 2 personnes      â”‚    â”‚
â”‚  â”‚    veulent cet      â”‚    â”‚
â”‚  â”‚    objet !          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## DÃ©pendances
- 5.2 : La page de dÃ©tail
- Epic 4 : Les prÃ©fÃ©rences doivent exister

## Stories LiÃ©es
- 5.7 : Vue des conflits (filtre galerie)
