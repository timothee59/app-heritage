# Story 5.7 - Voir les fiches "en conflit" (plusieurs coups de cÅ“ur)

## Epic
Epic 5 : Consultation et vues filtrÃ©es

## User Story
**En tant qu'** utilisateur  
**Je veux** voir les fiches avec plusieurs coups de cÅ“ur  
**Afin d'** identifier les objets qui nÃ©cessitent une discussion familiale

## Contexte
Quand plusieurs personnes veulent le mÃªme objet, il y a "conflit". Cette vue permet de les identifier rapidement pour organiser une discussion et prendre une dÃ©cision ensemble.

## PrioritÃ©
**Should** - TrÃ¨s utile mais pas bloquant pour le MVP minimal.

## CritÃ¨res d'Acceptation

- [ ] Un filtre "Conflits" dans la galerie affiche les fiches avec 2+ coups de cÅ“ur
- [ ] Le nombre de conflits est affichÃ© ("Conflits (3)")
- [ ] Sur la miniature, afficher les prÃ©noms en conflit
- [ ] Les fiches sont triÃ©es par nombre de conflits dÃ©croissant (les plus disputÃ©s d'abord)
- [ ] Si aucun conflit, afficher un message positif

## Ã‰lÃ©ments Techniques

### API Endpoint
```
GET /api/items?filter=conflicts
â†’ Retourne les fiches avec COUNT(love) >= 2
```

### SQL
```sql
SELECT 
  i.*,
  COUNT(p.id) as love_count,
  ARRAY_AGG(u.name) as lovers
FROM items i
JOIN preferences p ON i.id = p.item_id AND p.level = 'love'
JOIN users u ON p.user_id = u.id
WHERE i.deleted_at IS NULL
GROUP BY i.id
HAVING COUNT(p.id) >= 2
ORDER BY love_count DESC, i.number;
```

### Affichage dans la miniature
```jsx
function ConflictCard({ item }) {
  return (
    <div className="item-card conflict">
      <img src={item.photo} />
      <span className="item-number">#{item.number}</span>
      <div className="conflict-badge">
        âš ï¸ {item.lovers.join(' vs ')}
      </div>
    </div>
  );
}
```

### Styles pour les conflits
```css
.item-card.conflict {
  border: 2px solid #dc3545;
}

.conflict-badge {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  background: rgba(220, 53, 69, 0.9);
  color: white;
  padding: 4px;
  font-size: 0.7rem;
  text-align: center;
}
```

## Maquette SimplifiÃ©e

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¦ HÃ©ritage    [ğŸ‘¤ Marie]   â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                             â”‚
â”‚  [Tous] [â¤ï¸] [Ã€ voir] [âš ï¸]  â”‚
â”‚                        ^^^  â”‚
â”‚                       actif â”‚
â”‚                             â”‚
â”‚  Conflits (2)               â”‚
â”‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ğŸ“·        â”‚ â”‚ ğŸ“·        â”‚â”‚
â”‚  â”‚  #12      â”‚ â”‚  #47      â”‚â”‚
â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”‚
â”‚  â”‚âš ï¸Marie vs â”‚ â”‚âš ï¸Pierre vsâ”‚â”‚
â”‚  â”‚   Pierre  â”‚ â”‚   Jean    â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Si aucun conflit :
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                             â”‚
â”‚           âœŒï¸                â”‚
â”‚                             â”‚
â”‚  Aucun conflit !            â”‚
â”‚  La famille est en          â”‚
â”‚  harmonie.                  â”‚
â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## DÃ©pendances
- 5.1 : La galerie
- Epic 4 : Les prÃ©fÃ©rences (niveau "love")

## Stories LiÃ©es
- 5.3 : La section "Qui veut quoi" dans le dÃ©tail montre aussi le conflit
