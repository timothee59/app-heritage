# Story 3.3 - Ajouter un commentaire (souvenir, anecdote, origine)

## Epic
Epic 3 : Enrichissement collaboratif des fiches

## User Story
**En tant qu'** utilisateur  
**Je veux** ajouter un commentaire sur une fiche  
**Afin de** partager un souvenir, une anecdote ou l'histoire de l'objet

## Contexte
Contrairement au titre et √† la description (uniques et modifiables), les commentaires sont multiples et sign√©s. Chaque membre peut raconter son histoire avec cet objet : "C'est sur ce buffet que j'ai souffl√© mes 10 bougies !" sign√© Marie.

## Priorit√©
**Should** - Enrichit l'exp√©rience mais pas indispensable pour le MVP strict.

## Crit√®res d'Acceptation

- [ ] Une section "Commentaires" affiche tous les commentaires d'une fiche
- [ ] Chaque commentaire montre : texte, auteur (pr√©nom), date
- [ ] Un champ permet d'ajouter un nouveau commentaire
- [ ] Le commentaire est sign√© automatiquement avec l'utilisateur connect√©
- [ ] Les commentaires sont tri√©s du plus ancien au plus r√©cent
- [ ] Un commentaire ne peut pas √™tre modifi√© apr√®s publication (simplicit√©)
- [ ] L'auteur peut supprimer son propre commentaire

## √âl√©ments Techniques

### Table comments
```sql
CREATE TABLE comments (
  id SERIAL PRIMARY KEY,
  item_id INT REFERENCES items(id) ON DELETE CASCADE,
  user_id INT REFERENCES users(id),
  text TEXT NOT NULL,
  created_at TIMESTAMP DEFAULT NOW()
);
```

### API Endpoints
```
GET /api/items/:itemId/comments
‚Üí Retourne [{ id, text, user: { id, name }, created_at }]

POST /api/items/:itemId/comments
Body: { text: "Mon souvenir..." }
Headers: { X-User-Id: 123 }
‚Üí Retourne le commentaire cr√©√©

DELETE /api/items/:itemId/comments/:commentId
Headers: { X-User-Id: 123 }
‚Üí Supprime si l'utilisateur est l'auteur
```

### Affichage des commentaires
```jsx
function CommentsList({ comments }) {
  return (
    <div className="comments">
      {comments.map(comment => (
        <div key={comment.id} className="comment">
          <div className="comment-header">
            <strong>{comment.user.name}</strong>
            <span className="date">
              {formatDate(comment.created_at)}
            </span>
          </div>
          <p>{comment.text}</p>
        </div>
      ))}
    </div>
  );
}
```

### Format de date lisible
```javascript
function formatDate(dateString) {
  const date = new Date(dateString);
  const now = new Date();
  const diffDays = Math.floor((now - date) / (1000 * 60 * 60 * 24));
  
  if (diffDays === 0) return "Aujourd'hui";
  if (diffDays === 1) return "Hier";
  if (diffDays < 7) return `Il y a ${diffDays} jours`;
  
  return date.toLocaleDateString('fr-FR', {
    day: 'numeric',
    month: 'long'
  });
}
```

## Maquette Simplifi√©e

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ    [Photo + titre + desc]   ‚îÇ
‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ
‚îÇ                             ‚îÇ
‚îÇ    üí¨ Commentaires          ‚îÇ
‚îÇ                             ‚îÇ
‚îÇ    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
‚îÇ    ‚îÇ Marie ¬∑ Hier      ‚îÇ    ‚îÇ
‚îÇ    ‚îÇ C'est sur ce      ‚îÇ    ‚îÇ
‚îÇ    ‚îÇ buffet que j'ai   ‚îÇ    ‚îÇ
‚îÇ    ‚îÇ souffl√© mes 10    ‚îÇ    ‚îÇ
‚îÇ    ‚îÇ bougies !         ‚îÇ    ‚îÇ
‚îÇ    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
‚îÇ                             ‚îÇ
‚îÇ    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
‚îÇ    ‚îÇ Papa ¬∑ 3 jan.     ‚îÇ    ‚îÇ
‚îÇ    ‚îÇ Achet√© √† la       ‚îÇ    ‚îÇ
‚îÇ    ‚îÇ brocante de Lille ‚îÇ    ‚îÇ
‚îÇ    ‚îÇ en 1982           ‚îÇ    ‚îÇ
‚îÇ    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
‚îÇ                             ‚îÇ
‚îÇ    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
‚îÇ    ‚îÇ Ajouter un        ‚îÇ    ‚îÇ
‚îÇ    ‚îÇ commentaire...    ‚îÇ    ‚îÇ
‚îÇ    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
‚îÇ              [Envoyer]      ‚îÇ
‚îÇ                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## D√©pendances
- 5.2 : La page de d√©tail d'une fiche
- Epic 1 : Identification (pour signer les commentaires)

## Stories Li√©es
- 3.1, 3.2 : Autres formes d'enrichissement
