# Story 5.9 - Indicateurs de prÃ©fÃ©rence dans la vue "Par personne"

## Epic
Epic 5 : Consultation et vues filtrÃ©es

## User Story
**En tant qu'** utilisateur  
**Je veux** voir les indicateurs de prÃ©fÃ©rence sur les vignettes dans la vue "Par personne"  
**Afin de** savoir quel choix a Ã©tÃ© fait par cette personne sur chaque objet

## Contexte
Actuellement, la vue "Par personne" ne montre que les objets oÃ¹ la personne a mis un coup de cÅ“ur, sans indicateur visuel. L'utilisateur ne peut pas voir les objets marquÃ©s "Si personne d'autre" ou les objets refusÃ©s. Cette story enrichit la vue pour afficher tous les choix avec leurs indicateurs.

## CritÃ¨res d'Acceptation

- [ ] La vue "Par personne" affiche TOUS les objets oÃ¹ la personne a exprimÃ© un avis (love, maybe, no)
- [ ] Chaque vignette affiche l'icÃ´ne correspondant au choix de la personne :
  - CÅ“ur rouge = "Je le veux !"
  - Main orange = "Si personne d'autre"
  - Croix grise = "Pas intÃ©ressÃ©"
- [ ] L'icÃ´ne est visible en overlay sur la vignette (coin supÃ©rieur droit)
- [ ] Les icÃ´nes sont suffisamment grandes pour Ãªtre lisibles (minimum 20px)
- [ ] Le filtre continue de fonctionner aprÃ¨s sÃ©lection d'un utilisateur

## Ã‰lÃ©ments Techniques

### API Endpoint modifiÃ©
```
GET /api/items?filter=user-preferences&userId=123
â†’ Retourne les fiches oÃ¹ l'utilisateur a UNE prÃ©fÃ©rence (love, maybe OU no)
â†’ Inclut le niveau de prÃ©fÃ©rence dans la rÃ©ponse
```

### Nouveau type de rÃ©ponse
```typescript
type ItemWithUserPreference = ItemWithPhotos & {
  userPreference: "love" | "maybe" | "no";
};
```

### Storage
```typescript
getItemsByUserAllPreferences(userId: number): Promise<ItemWithUserPreference[]>
```

### SQL
```sql
SELECT i.*, p.level as user_preference
FROM items i
JOIN preferences p ON i.id = p.item_id AND p.user_id = $1
ORDER BY i.number;
```

### Badge sur vignette
```jsx
{userPreference && (
  <div className="absolute top-2 right-2 w-6 h-6 rounded-full bg-white/80 flex items-center justify-center">
    {userPreference === "love" && <Heart className="w-4 h-4 text-red-500 fill-red-500" />}
    {userPreference === "maybe" && <Hand className="w-4 h-4 text-orange-500" />}
    {userPreference === "no" && <X className="w-4 h-4 text-gray-400" />}
  </div>
)}
```

## Maquette SimplifiÃ©e

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Par personne : [Marie â–¼]        â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸ“·  â¤ï¸â”‚ â”‚ ğŸ“·  âœ‹â”‚ â”‚ ğŸ“·  âœ• â”‚ â”‚
â”‚  â”‚  #1   â”‚ â”‚  #3   â”‚ â”‚  #5   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                 â”‚
â”‚  LÃ©gende :                      â”‚
â”‚  â¤ï¸ = Je le veux                â”‚
â”‚  âœ‹ = Si personne d'autre       â”‚
â”‚  âœ• = Pas intÃ©ressÃ©             â”‚
â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## DÃ©pendances
- 5.1 : La galerie
- Epic 4 : Les prÃ©fÃ©rences

## Stories LiÃ©es
- 5.4 : Vue "Mes coups de cÅ“ur"
- 5.5 : Vue "Par personne" (story originale)
