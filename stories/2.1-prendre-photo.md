# Story 2.1 - Prendre une photo depuis l'app

## Epic
Epic 2 : CrÃ©ation du catalogue photo

## User Story
**En tant qu'** utilisateur  
**Je veux** prendre une photo directement depuis l'application  
**Afin de** cataloguer rapidement un objet de la maison

## Contexte
Les parents (principalement) vont photographier des dizaines d'objets. Le flux doit Ãªtre ultra-simple : photo â†’ fiche crÃ©Ã©e. Pas de formulaire, pas de questions.

## CritÃ¨res d'Acceptation

- [ ] Un bouton "+" ou "Ajouter" visible sur la galerie principale
- [ ] Ce bouton ouvre la camÃ©ra de l'appareil
- [ ] L'utilisateur peut prendre une photo
- [ ] AprÃ¨s capture, la photo est sauvegardÃ©e et une fiche est crÃ©Ã©e automatiquement
- [ ] La fiche reÃ§oit un numÃ©ro auto-incrÃ©mentÃ© (ex: #1, #2, #3...)
- [ ] L'utilisateur est redirigÃ© vers la nouvelle fiche ou reste sur la galerie (au choix UX)
- [ ] Un feedback visuel confirme la crÃ©ation ("Fiche #12 crÃ©Ã©e !")

## Ã‰lÃ©ments Techniques

### AccÃ¨s CamÃ©ra (HTML5)
```html
<input 
  type="file" 
  accept="image/*" 
  capture="environment"
  onChange={handleCapture}
/>
```

Note : `capture="environment"` ouvre la camÃ©ra arriÃ¨re sur mobile.

### Compression d'image
Les photos de smartphone font souvent 3-5 Mo. Compresser avant envoi :
```javascript
// Utiliser canvas pour redimensionner
const MAX_WIDTH = 1200;
const MAX_HEIGHT = 1200;
const QUALITY = 0.8;

function compressImage(file) {
  return new Promise((resolve) => {
    const reader = new FileReader();
    reader.onload = (e) => {
      const img = new Image();
      img.onload = () => {
        const canvas = document.createElement('canvas');
        let { width, height } = img;
        
        if (width > MAX_WIDTH) {
          height = (height * MAX_WIDTH) / width;
          width = MAX_WIDTH;
        }
        if (height > MAX_HEIGHT) {
          width = (width * MAX_HEIGHT) / height;
          height = MAX_HEIGHT;
        }
        
        canvas.width = width;
        canvas.height = height;
        const ctx = canvas.getContext('2d');
        ctx.drawImage(img, 0, 0, width, height);
        resolve(canvas.toDataURL('image/jpeg', QUALITY));
      };
      img.src = e.target.result;
    };
    reader.readAsDataURL(file);
  });
}
```

### API Endpoint
```
POST /api/items
Body: { photo: "data:image/jpeg;base64,..." }
Headers: { X-User-Id: 123 }
â†’ Retourne { id, number, created_by, created_at }
```

### Base de donnÃ©es
```sql
-- CrÃ©er la fiche
INSERT INTO items (number, created_by) 
VALUES (
  (SELECT COALESCE(MAX(number), 0) + 1 FROM items),
  $1
) RETURNING id, number;

-- Ajouter la photo
INSERT INTO photos (item_id, data, position) 
VALUES ($1, $2, 0);
```

## Maquette SimplifiÃ©e

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¦ HÃ©ritage    [ğŸ‘¤ Marie]   â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ #1  â”‚ â”‚ #2  â”‚ â”‚ #3  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ #4  â”‚ â”‚ #5  â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                             â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚              â”‚  ğŸ“· +   â”‚    â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## DÃ©pendances
- Epic 1 complet : L'utilisateur doit Ãªtre identifiÃ©
- 5.1 : La galerie doit exister (mÃªme vide)

## Stories LiÃ©es
- 2.2 : Importer depuis la galerie (alternative Ã  la camÃ©ra)
- 2.4 : Ajouter plusieurs photos Ã  une fiche
